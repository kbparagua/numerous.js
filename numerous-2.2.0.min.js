// Numerous.js
// Unobtrusive Javascript helper for dynamically creating fields_for objects for Rails.
// Version 2.2.0
//
// Author: Karl Bryan Paragua
// Source: https://github.com/kbparagua/numerous.js
$(document).ready(function(){Numerous={init:function(d){var c=$(".numerous");Numerous.addFormHash={};Numerous.options=d||{};var a=0;for(d=c.length;a<d;a++){var b=$(c[a]),h=b.attr("id"),e=h.replace(/fields-for-/,""),f="add-to-"+e,j="#"+e,g=Numerous.options[e];b.removeClass("numerous").attr("id","");var k=$("<div></div>").append(b);Numerous.addFormHash[f]={form:k.html(),"fields-for":h,"update-div":j,list:e};b.remove();Numerous.clickHandlerForAdd(f);Numerous.createHandlersForRemove(e);if(g){a=g.initial;
f=$("#"+f);b=a;"function"===typeof a&&(b=a());for(a=0;a<b;a++)f.trigger("click");(g=g["after-initialize"])&&g()}}},clickHandlerForAdd:function(d){$("#"+d).click(function(c){c.preventDefault();var a=Numerous.addFormHash[this.id],b=(new Date).getTime();c=a.form.replace(/replace_this/g,b);c=$(c);c.addClass(a["fields-for"]);namePrefix=c.find("[name*="+b+"]:first").attr("name").match(RegExp("^(\\[|\\]|\\w|\\s|-)+\\["+b+"\\]"))[0];removeInputName=namePrefix+"[_destroy]";removeInput=$('<input type="hidden" value="0" class="numerous-remove-field" name="'+
removeInputName+'"/>');c.append(removeInput);b=Numerous.options[a.list];c.hide();$(a["update-div"]).append(c);c.show(b&&b["animation-options"]||{});b&&(a=b.add)&&a(c)})},createHandlersForRemove:function(d){var c=".fields-for-"+d+" .numerous-remove";$("body").off("click",c);$("body").on("click",c,function(a){a.preventDefault();a=$(this);var b=a.parent().closest(".fields-for-"+d),c=a.siblings(".numerous-remove-field:first");a=Numerous.options[d];if(0==c.length){var e=b.find('input[name*="[id]"]:first');
if(0==e.length){e=a&&a["animation-options"]||{};if(e.complete){var f=e.complete;e.complete=function(){f();b.remove()}}else e.complete=function(){b.remove()};b.hide(e)}else c=e.attr("name").replace("[id]","")+"[_destroy]",c=$('<input type="hidden" value="0"class="numerous-remove-field" name="'+c+'"/>'),b.append(c)}c.attr("value","1");b.removeClass("fields-for-"+d);b.hide(a&&a["animation-options"]||{});a&&(a=a.remove)&&a(b)})},count:function(d){return $(".fields-for-"+d).length},get:function(d){return $(".fields-for-"+
d)},removeAll:function(d){Numerous.get(d).find(".numerous-remove").trigger("click")}}});
